<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <title>üéâ Your Celebration Card | Celebration Wishes üéâ</title>
    <!-- Add this to both create.html and view.html -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Nunito', sans-serif;
        }
        .pacifico {
            font-family: 'Pacifico', cursive;
        }
        
        /* Enhanced Animations */
        .heartbeat {
            animation: heartbeat 1.5s ease-in-out infinite both;
        }
        @keyframes heartbeat {
            0% { transform: scale(1); }
            25% { transform: scale(1.1); }
            50% { transform: scale(1); }
            75% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            opacity: 0;
            pointer-events: none;
        }
        @keyframes confetti-fall {
            0% { transform: translateY(-100px) rotate(0deg) scale(1); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg) scale(0); opacity: 0; }
        }
        
        .float {
            animation: float 6s ease-in-out infinite;
        }
        @keyframes float {
            0% { transform: translateY(0px) rotate(0deg); }
            25% { transform: translateY(-20px) rotate(5deg); }
            50% { transform: translateY(-40px) rotate(0deg); }
            75% { transform: translateY(-20px) rotate(-5deg); }
            100% { transform: translateY(0px) rotate(0deg); }
        }
        
        .neon-text {
            text-shadow: 0 0 10px currentColor, 0 0 20px currentColor;
        }
        
        .shine {
            animation: shine 3s infinite;
        }
        @keyframes shine {
            0%, 100% { opacity: 1; filter: brightness(1); }
            50% { opacity: 0.9; filter: brightness(1.4); }
        }
        
        .pulse-glow {
            animation: pulseGlow 2s infinite;
        }
        @keyframes pulseGlow {
            0%, 100% { 
                box-shadow: 0 0 10px currentColor, 0 0 20px currentColor; 
            }
            50% { 
                box-shadow: 0 0 30px currentColor, 0 0 50px currentColor; 
            }
        }
        
        .ripple {
            animation: ripple 2s infinite;
        }
        @keyframes ripple {
            0% { transform: scale(1); opacity: 0.8; }
            100% { transform: scale(4); opacity: 0; }
        }
        
        .particle {
            position: absolute;
            border-radius: 50%;
            pointer-events: none;
            z-index: 1000;
        }
        
        .slide-in {
            animation: slideIn 0.8s ease-out;
        }
        @keyframes slideIn {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        /* New Animations */
        .rainbow-bg {
            background: linear-gradient(
                90deg,
                #ff6b6b,
                #ffa500,
                #ffff00,
                #00ff00,
                #00ffff,
                #0000ff,
                #8a2be2,
                #ff00ff
            );
            background-size: 400% 400%;
            animation: rainbowFlow 15s ease infinite;
        }
        @keyframes rainbowFlow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .balloon {
            animation: balloonFloat 20s ease-in-out infinite;
        }
        @keyframes balloonFloat {
            0% { transform: translateY(100vh) translateX(0) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(-100px) translateX(var(--tx)) rotate(var(--rot)); opacity: 0; }
        }
        
        .firework {
            animation: fireworkBurst 1.5s ease-out forwards;
        }
        @keyframes fireworkBurst {
            0% { transform: scale(0) translateY(0); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: scale(1.5) translateY(var(--ty)); opacity: 0; }
        }
        
        .emoji-rain {
            animation: emojiFall 5s linear infinite;
        }
        @keyframes emojiFall {
            0% { transform: translateY(-100px) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }
        
        .sparkle-trail {
            animation: sparkleTrail 1s ease-out forwards;
        }
        @keyframes sparkleTrail {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(0); opacity: 0; }
        }
        
        .bounce-3d {
            animation: bounce3d 2s ease infinite;
        }
        @keyframes bounce3d {
            0%, 100% { transform: translateY(0) rotateX(0); }
            50% { transform: translateY(-30px) rotateX(10deg); }
        }
        
        /* Background effects */
        .background-grid {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(255,255,255,0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255,255,255,0.05) 1px, transparent 1px);
            background-size: 50px 50px;
            pointer-events: none;
            z-index: 0;
        }
        
        .glow-orbs {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }
        
        .orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(40px);
            opacity: 0.1;
            animation: orbFloat 20s ease-in-out infinite;
        }
        @keyframes orbFloat {
            0%, 100% { transform: translate(0, 0); }
            25% { transform: translate(100px, 50px); }
            50% { transform: translate(50px, 100px); }
            75% { transform: translate(-50px, 50px); }
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .mobile-stack { flex-direction: column !important; }
            .mobile-text-center { text-align: center !important; }
            .mobile-p-4 { padding: 1rem !important; }
            .mobile-space-y-4 > * + * { margin-top: 1rem !important; }
            .mobile-w-full { width: 100% !important; }
            .mobile-h-auto { height: auto !important; }
            .mobile-text-sm { font-size: 0.875rem !important; }
            .mobile-text-lg { font-size: 1.125rem !important; }
            .mobile-text-xl { font-size: 1.25rem !important; }
            .mobile-hidden { display: none !important; }
            
            .card-container {
                min-height: 400px !important;
            }
            
            .action-button {
                min-height: 44px;
                padding: 12px 16px !important;
            }
            
            .header-text {
                font-size: 1.5rem !important;
            }
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: linear-gradient(180deg, rgba(6, 182, 212, 0.1), rgba(139, 92, 246, 0.1));
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #06b6d4, #8b5cf6);
            border-radius: 10px;
        }
        
        /* Glass morphism */
        .glass-effect {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* 3D Transform */
        .transform-3d {
            transform-style: preserve-3d;
            perspective: 1000px;
        }
        
        .rotate-3d {
            animation: rotate3d 10s linear infinite;
        }
        @keyframes rotate3d {
            0% { transform: rotateY(0deg) rotateX(0deg); }
            50% { transform: rotateY(180deg) rotateX(10deg); }
            100% { transform: rotateY(360deg) rotateX(0deg); }
        }
        
        /* Celebration emojis */
        .celebration-emoji {
            font-size: 24px;
            animation: emojiPop 2s ease-out forwards;
        }
        @keyframes emojiPop {
            0% { transform: scale(0) rotate(0deg); opacity: 0; }
            50% { transform: scale(1.2) rotate(180deg); opacity: 1; }
            100% { transform: scale(1) rotate(360deg); opacity: 1; }
        }
        
        /* Glowing text effect */
        .glow-text {
            text-shadow: 
                0 0 5px currentColor,
                0 0 10px currentColor,
                0 0 15px currentColor,
                0 0 20px currentColor,
                0 0 35px currentColor,
                0 0 40px currentColor,
                0 0 50px currentColor,
                0 0 75px currentColor;
            animation: textGlow 3s ease-in-out infinite;
        }
        @keyframes textGlow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.5); }
        }
        
        /* New animation classes */
        .animate-pop-in {
            animation: popIn 0.5s ease-out;
        }
        
        @keyframes popIn {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .animate-ripple {
            animation: ripple 2s infinite;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-900 via-gray-800 to-black min-h-screen overflow-x-hidden">
    
    <!-- Enhanced Background Effects -->
    <div class="fixed top-0 left-0 w-full h-full overflow-hidden pointer-events-none z-0" id="backgroundEffects">
        <!-- Background particles will be added here -->
    </div>
    
    <!-- Grid Pattern -->
    <div class="background-grid"></div>
    
    <!-- Glow Orbs -->
    <div class="glow-orbs">
        <div class="orb bg-cyan-500 w-96 h-96 top-20 left-10"></div>
        <div class="orb bg-purple-500 w-80 h-80 bottom-20 right-10" style="animation-delay: -5s;"></div>
        <div class="orb bg-pink-500 w-64 h-64 top-1/3 left-1/3" style="animation-delay: -10s;"></div>
        <div class="orb bg-yellow-500 w-72 h-72 bottom-1/3 right-1/3" style="animation-delay: -15s;"></div>
    </div>

    <!-- Mobile Navigation -->
    <div class="md:hidden fixed top-0 left-0 right-0 bg-gradient-to-r from-cyan-600 via-purple-600 to-pink-600 p-4 z-50 shadow-lg">
        <div class="flex justify-between items-center">
            <a href="index.html" class="text-white text-lg font-bold flex items-center">
                <i class="fas fa-arrow-left mr-2"></i>
                <span>Back</span>
            </a>
            <div class="flex items-center">
                <div class="w-2 h-2 bg-green-400 rounded-full mr-2 animate-pulse"></div>
                <span class="text-white text-sm">Live Celebration</span>
            </div>
        </div>
    </div>

    <div class="container mx-auto px-4 py-20 md:py-8 relative z-10">
        
        <!-- Header -->
        <header class="text-center mb-8 md:mb-10 slide-in">
            <a href="index.html" class="inline-block mb-4 md:mb-6 group">
                <div class="flex items-center justify-center">
                    <div class="w-10 h-10 md:w-12 md:h-12 rounded-full bg-gradient-to-r from-cyan-500 via-purple-500 to-pink-500 flex items-center justify-center mr-3 group-hover:scale-110 transition-transform duration-300 animate-pulse-glow">
                        <i class="fas fa-home text-white text-lg md:text-xl"></i>
                    </div>
                    <h1 class="text-2xl md:text-4xl font-bold pacifico bg-gradient-to-r from-cyan-400 via-purple-400 to-pink-400 bg-clip-text text-transparent glow-text">
                        üéä Celebration Wishes üéä
                    </h1>
                </div>
            </a>
            <p class="text-gray-300 text-base md:text-lg">‚ú® A magical celebration card has arrived just for you! ‚ú®</p>
        </header>

        <!-- Main Card Display -->
        <div class="max-w-4xl mx-auto">
            
            <!-- Celebration Stats -->
            <div id="celebrationStats" class="glass-effect rounded-3xl p-4 md:p-6 mb-6 md:mb-8 grid grid-cols-3 gap-3 md:gap-4 text-center slide-in">
                <div class="p-3 md:p-4 bg-gradient-to-br from-cyan-500/10 to-blue-500/10 rounded-2xl backdrop-blur-sm border border-cyan-500/20">
                    <div class="text-xl md:text-3xl font-bold text-cyan-300" id="viewCount">0</div>
                    <div class="text-xs md:text-sm text-gray-400">üëÅÔ∏è Views</div>
                </div>
                <div class="p-3 md:p-4 bg-gradient-to-br from-purple-500/10 to-pink-500/10 rounded-2xl backdrop-blur-sm border border-purple-500/20">
                    <div class="text-xl md:text-3xl font-bold text-purple-300" id="confettiCount">0</div>
                    <div class="text-xs md:text-sm text-gray-400">üéä Confetti</div>
                </div>
                <div class="p-3 md:p-4 bg-gradient-to-br from-amber-500/10 to-orange-500/10 rounded-2xl backdrop-blur-sm border border-amber-500/20">
                    <div class="text-xl md:text-3xl font-bold text-amber-300" id="timeSpent">0s</div>
                    <div class="text-xs md:text-sm text-gray-400">‚è±Ô∏è Celebrating</div>
                </div>
            </div>

            <div id="cardContainer" class="rounded-4xl overflow-hidden shadow-[0_0_80px_rgba(59,130,246,0.4)] transition-all duration-1000 transform hover:scale-[1.01] glass-effect border border-white/10">
                <!-- Template 1 (Ocean Breeze) -->
                <div id="template1" class="hidden">
                    <div class="min-h-[500px] md:min-h-[600px] bg-gradient-to-br from-cyan-900/30 via-blue-900/30 to-purple-900/30 p-6 md:p-12 relative overflow-hidden">
                        <!-- Ocean waves -->
                        <div class="absolute bottom-0 left-0 right-0 h-32 bg-gradient-to-t from-cyan-500/20 via-blue-500/15 to-transparent"></div>
                        <div class="absolute top-10 left-10 w-60 h-60 bg-cyan-500/10 rounded-full blur-3xl animate-pulse"></div>
                        <div class="absolute bottom-10 right-10 w-80 h-80 bg-blue-500/10 rounded-full blur-3xl animate-pulse" style="animation-delay: 1s;"></div>
                        
                        <!-- Floating islands -->
                        <div class="absolute top-20 left-1/4 w-24 h-24 rounded-full bg-gradient-to-r from-cyan-700/20 to-blue-700/20 blur-xl"></div>
                        <div class="absolute bottom-32 right-1/4 w-32 h-32 rounded-full bg-gradient-to-r from-purple-700/20 to-blue-700/20 blur-xl"></div>
                        
                        <div class="text-center relative z-10 h-full flex flex-col justify-center transform-3d">
                            <!-- Animated Photo/Icon with 3D effect -->
                            <div class="flex justify-center mb-6 md:mb-8">
                                <div id="template1Photo" class="w-28 h-28 md:w-36 md:h-36 rounded-full bg-gradient-to-r from-cyan-500 to-blue-600 flex items-center justify-center shadow-2xl border-8 border-white/80 float bounce-3d rotate-3d">
                                    <i id="template1Icon" class="fas fa-birthday-cake text-white text-3xl md:text-5xl"></i>
                                </div>
                                <!-- Floating bubbles -->
                                <div class="absolute top-16 left-1/4 w-8 h-8 bg-white/30 rounded-full float" style="animation-delay: 1s;"></div>
                                <div class="absolute top-10 right-1/4 w-6 h-6 bg-white/30 rounded-full float" style="animation-delay: 2s;"></div>
                                <div class="absolute bottom-20 left-1/3 w-10 h-10 bg-cyan-500/30 rounded-full float" style="animation-delay: 0.5s;"></div>
                            </div>
                            
                            <!-- Occasion with glow -->
                            <h3 id="template1Occasion" class="text-xl md:text-2xl font-bold text-cyan-300 mb-2 glow-text">üéÇ Happy Birthday</h3>
                            
                            <!-- Recipient Name with enhanced glow -->
                            <h2 id="template1Name" class="text-4xl md:text-5xl lg:text-6xl font-bold mb-6 bg-gradient-to-r from-cyan-400 via-blue-400 to-cyan-300 bg-clip-text text-transparent neon-text shine glow-text">Alex!</h2>
                            
                            <!-- Message with floating effect -->
                            <div class="bg-white/5 rounded-3xl p-6 md:p-8 mb-6 md:mb-8 shadow-2xl backdrop-blur-xl border border-white/20 float" style="animation-duration: 8s;">
                                <div class="relative">
                                    <div class="absolute -top-2 -left-2 w-6 h-6 bg-cyan-500 rounded-full animate-pulse"></div>
                                    <div class="absolute -bottom-2 -right-2 w-6 h-6 bg-blue-500 rounded-full animate-pulse" style="animation-delay: 0.5s;"></div>
                                    <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-cyan-500 to-transparent"></div>
                                    <p id="template1Message" class="text-gray-200 text-lg md:text-xl italic leading-relaxed relative z-10">"Wishing you a day filled with happiness and a year filled with joy! Hope all your birthday wishes come true!"</p>
                                    <div class="absolute bottom-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-blue-500 to-transparent"></div>
                                </div>
                            </div>
                            
                            <!-- Sender with sparkle effect -->
                            <div class="text-right relative">
                                <p id="template1Sender" class="text-gray-300 text-base md:text-lg inline-block bg-gradient-to-r from-cyan-900/30 to-blue-900/30 px-6 py-3 rounded-2xl border border-cyan-500/30">
                                    From your friend, <span class="font-bold text-cyan-300">Jordan</span>
                                </p>
                                <div class="absolute -top-2 -right-2 w-4 h-4 bg-yellow-400 rounded-full animate-pulse"></div>
                            </div>
                            
                            <!-- Animated Elements -->
                            <div class="mt-8 md:mt-12 flex justify-center space-x-4 md:space-x-8">
                                <div class="w-10 h-14 md:w-12 md:h-16 bg-gradient-to-b from-cyan-400 to-blue-500 rounded-full animate-bounce float" style="animation-delay: 0.1s;"></div>
                                <div class="w-10 h-14 md:w-12 md:h-16 bg-gradient-to-b from-emerald-400 to-green-500 rounded-full animate-bounce float" style="animation-delay: 0.3s;"></div>
                                <div class="w-10 h-14 md:w-12 md:h-16 bg-gradient-to-b from-amber-400 to-orange-500 rounded-full animate-bounce float" style="animation-delay: 0.5s;"></div>
                                <div class="w-10 h-14 md:w-12 md:h-16 bg-gradient-to-b from-pink-400 to-rose-500 rounded-full animate-bounce float" style="animation-delay: 0.7s;"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Template 2 (Neon Dream) -->
                <div id="template2" class="hidden">
                    <div class="min-h-[500px] md:min-h-[600px] bg-gradient-to-br from-purple-900/40 via-pink-900/30 to-rose-900/40 p-6 md:p-12 relative overflow-hidden">
                        <!-- Neon glow effects -->
                        <div class="absolute top-10 left-10 w-80 h-80 bg-purple-500/20 rounded-full blur-3xl animate-pulse"></div>
                        <div class="absolute bottom-10 right-10 w-96 h-96 bg-pink-500/20 rounded-full blur-3xl animate-pulse" style="animation-delay: 1s;"></div>
                        
                        <!-- Neon grid pattern -->
                        <div class="absolute inset-0 opacity-10" style="background-image: 
                            linear-gradient(90deg, transparent 95%, rgba(192, 132, 252, 0.3) 100%),
                            linear-gradient(180deg, transparent 95%, rgba(236, 72, 153, 0.3) 100%);
                            background-size: 50px 50px;"></div>
                        
                        <!-- Floating diamonds -->
                        <div class="absolute top-1/4 left-1/4 w-16 h-16 bg-gradient-to-r from-purple-600/30 to-pink-600/30 rotate-45 blur-sm"></div>
                        <div class="absolute bottom-1/4 right-1/4 w-20 h-20 bg-gradient-to-r from-pink-600/30 to-rose-600/30 rotate-45 blur-sm"></div>
                        
                        <div class="text-center relative z-10 h-full flex flex-col justify-center">
                            <!-- Photo/Icon with enhanced ripple -->
                            <div class="flex justify-center mb-8 md:mb-10">
                                <div class="relative">
                                    <div id="template2Photo" class="w-32 h-32 md:w-40 md:h-40 rounded-full bg-gradient-to-r from-purple-600 to-pink-500 flex items-center justify-center shadow-[0_0_60px_rgba(192,132,252,0.8)] border-4 border-purple-300/50 pulse-glow relative z-10 heartbeat">
                                        <i id="template2Icon" class="fas fa-star text-white text-4xl md:text-5xl"></i>
                                    </div>
                                    <!-- Enhanced ripple effects -->
                                    <div class="absolute inset-0 rounded-full bg-gradient-to-r from-purple-600 to-pink-500 opacity-40 animate-ripple" style="animation-delay: 0.5s;"></div>
                                    <div class="absolute inset-0 rounded-full bg-gradient-to-r from-purple-600 to-pink-500 opacity-30 animate-ripple" style="animation-delay: 1s;"></div>
                                    <div class="absolute inset-0 rounded-full bg-gradient-to-r from-purple-600 to-pink-500 opacity-20 animate-ripple" style="animation-delay: 1.5s;"></div>
                                </div>
                            </div>
                            
                            <!-- Occasion -->
                            <h3 id="template2Occasion" class="text-xl md:text-2xl font-bold text-purple-300 mb-4 neon-text">üéÇ Happy Birthday</h3>
                            
                            <!-- Recipient Name with enhanced neon -->
                            <h2 id="template2Name" class="text-4xl md:text-6xl lg:text-7xl font-bold mb-6 md:mb-8 text-transparent bg-clip-text bg-gradient-to-r from-purple-300 via-pink-300 to-purple-300 neon-text shine glow-text" style="animation-duration: 2s;">Alex!</h2>
                            
                            <!-- Message with neon border -->
                            <div class="bg-gray-900/30 rounded-3xl p-6 md:p-8 mb-6 md:mb-10 border-2 border-purple-500/40 backdrop-blur-lg relative overflow-hidden">
                                <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-purple-500 to-transparent"></div>
                                <div class="absolute inset-0 bg-gradient-to-r from-purple-500/5 to-pink-500/5"></div>
                                <p id="template2Message" class="text-gray-200 text-lg md:text-xl italic leading-relaxed relative z-10">"Wishing you a day filled with happiness and a year filled with joy! Hope all your birthday wishes come true!"</p>
                                <div class="absolute bottom-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-pink-500 to-transparent"></div>
                            </div>
                            
                            <!-- Sender -->
                            <div class="text-right">
                                <p id="template2Sender" class="text-purple-300 text-base md:text-lg inline-block bg-gradient-to-r from-purple-900/30 to-pink-900/30 px-6 py-3 rounded-2xl border border-purple-500/30">
                                    From your friend, <span class="font-bold text-white neon-text">Jordan</span>
                                </p>
                            </div>
                            
                            <!-- Floating neon elements -->
                            <div class="mt-8 md:mt-12 flex justify-center space-x-6 md:space-x-12">
                                <i class="fas fa-heart text-pink-500 text-2xl md:text-4xl animate-pulse float" style="animation-delay: 0.2s;"></i>
                                <i class="fas fa-star text-purple-500 text-2xl md:text-4xl animate-pulse float" style="animation-delay: 0.4s;"></i>
                                <i class="fas fa-bolt text-cyan-400 text-2xl md:text-4xl animate-pulse float" style="animation-delay: 0.6s;"></i>
                                <i class="fas fa-moon text-indigo-400 text-2xl md:text-4xl animate-pulse float" style="animation-delay: 0.8s;"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Template 3 (Sunset Glow) -->
                <div id="template3" class="hidden">
                    <div class="min-h-[500px] md:min-h-[600px] bg-gradient-to-br from-amber-900/20 via-orange-900/20 to-yellow-900/20 p-6 md:p-12 relative overflow-hidden">
                        <!-- Sun rays with enhanced effect -->
                        <div class="absolute top-0 left-0 right-0 h-3 bg-gradient-to-r from-amber-500 via-orange-500 to-yellow-500"></div>
                        <div class="absolute bottom-0 left-0 right-0 h-3 bg-gradient-to-r from-yellow-500 via-orange-500 to-amber-500"></div>
                        <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-96 h-96 bg-gradient-to-r from-amber-500/10 to-orange-500/10 rounded-full blur-3xl animate-pulse"></div>
                        
                        <!-- Sun flare effects -->
                        <div class="absolute top-1/4 left-1/4 w-32 h-32 bg-gradient-to-r from-amber-500/20 to-yellow-500/20 rounded-full blur-2xl"></div>
                        <div class="absolute bottom-1/3 right-1/3 w-40 h-40 bg-gradient-to-r from-orange-500/20 to-red-500/20 rounded-full blur-2xl"></div>
                        
                        <div class="text-center relative z-10 h-full flex flex-col justify-center">
                            <!-- Photo/Icon with crown jewels -->
                            <div class="flex justify-center mb-8 md:mb-12">
                                <div id="template3Photo" class="w-32 h-32 md:w-44 md:h-44 rounded-full border-8 border-amber-300/50 bg-gradient-to-br from-amber-200/20 to-yellow-200/20 flex items-center justify-center shadow-2xl relative float">
                                    <i id="template3Icon" class="fas fa-crown text-amber-400 text-4xl md:text-6xl"></i>
                                    <!-- Enhanced sparkle effects -->
                                    <div class="absolute -top-3 -right-3 w-8 h-8 bg-yellow-400 rounded-full animate-pulse"></div>
                                    <div class="absolute -bottom-3 -left-3 w-6 h-6 bg-amber-400 rounded-full animate-pulse" style="animation-delay: 0.5s;"></div>
                                    <div class="absolute top-1/2 -right-4 w-4 h-4 bg-orange-400 rounded-full animate-pulse" style="animation-delay: 0.3s;"></div>
                                    <div class="absolute -left-4 top-1/2 w-4 h-4 bg-yellow-300 rounded-full animate-pulse" style="animation-delay: 0.7s;"></div>
                                </div>
                            </div>
                            
                            <!-- Occasion -->
                            <h3 id="template3Occasion" class="text-lg md:text-2xl font-semibold text-amber-300 mb-4">üéÇ Happy Birthday</h3>
                            
                            <!-- Recipient Name with golden glow -->
                            <h2 id="template3Name" class="text-4xl md:text-6xl lg:text-7xl font-bold mb-8 md:mb-10 text-transparent bg-clip-text bg-gradient-to-r from-amber-300 via-yellow-300 to-orange-300 glow-text shine">Alex!</h2>
                            
                            <!-- Message with golden border -->
                            <div class="border-4 border-amber-300/30 rounded-3xl p-6 md:p-8 mb-8 md:mb-10 bg-gradient-to-br from-amber-900/10 to-yellow-900/10 shadow-2xl relative float" style="animation-duration: 7s;">
                                <div class="absolute -top-3 left-1/2 transform -translate-x-1/2 w-8 h-8 bg-amber-500 rounded-full"></div>
                                <div class="absolute -bottom-3 left-1/2 transform -translate-x-1/2 w-8 h-8 bg-orange-500 rounded-full"></div>
                                <p id="template3Message" class="text-gray-200 text-lg md:text-xl italic leading-relaxed">"Wishing you a day filled with happiness and a year filled with joy! Hope all your birthday wishes come true!"</p>
                            </div>
                            
                            <!-- Sender -->
                            <div class="text-center border-t-4 border-amber-300/30 pt-6 md:pt-8">
                                <p id="template3Sender" class="text-amber-300 text-base md:text-xl inline-block bg-gradient-to-r from-amber-900/20 to-orange-900/20 px-6 py-3 rounded-2xl border border-amber-500/30">
                                    From your friend, <span class="font-bold text-yellow-300">Jordan</span>
                                </p>
                            </div>
                            
                            <!-- Golden elements with enhanced animation -->
                            <div class="mt-8 md:mt-12 flex justify-center space-x-4 md:space-x-10">
                                <i class="fas fa-gem text-amber-400 text-2xl md:text-4xl rotate-12 float bounce-3d" style="animation-delay: 0.1s;"></i>
                                <i class="fas fa-gem text-yellow-500 text-2xl md:text-4xl -rotate-12 float bounce-3d" style="animation-delay: 0.3s;"></i>
                                <i class="fas fa-gem text-orange-400 text-2xl md:text-4xl rotate-12 float bounce-3d" style="animation-delay: 0.5s;"></i>
                                <i class="fas fa-crown text-yellow-300 text-2xl md:text-4xl float bounce-3d" style="animation-delay: 0.7s;"></i>
                                <i class="fas fa-gem text-red-400 text-2xl md:text-4xl -rotate-12 float bounce-3d" style="animation-delay: 0.9s;"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Celebration Actions -->
            <div class="mt-6 md:mt-10 space-y-4 md:space-y-6">
                <!-- Main Actions -->
                <div class="flex flex-col md:flex-row justify-center gap-3 md:gap-6">
                    <a href="create.html" class="group px-6 py-4 md:px-8 md:py-5 bg-gradient-to-r from-cyan-600 to-blue-700 text-white font-bold rounded-3xl hover:from-cyan-700 hover:to-blue-800 transition-all duration-300 shadow-2xl hover:shadow-3xl transform hover:-translate-y-1 text-center action-button slide-in">
                        <i class="fas fa-magic mr-2 md:mr-3 group-hover:rotate-180 transition-transform duration-500"></i> Create Your Own
                    </a>
                    <button id="shareButton" class="group px-6 py-4 md:px-8 md:py-5 bg-gradient-to-r from-purple-600 to-pink-700 text-white font-bold rounded-3xl hover:from-purple-700 hover:to-pink-800 transition-all duration-300 shadow-2xl hover:shadow-3xl transform hover:-translate-y-1 action-button slide-in" style="animation-delay: 0.1s;">
                        <i class="fas fa-share-alt mr-2 md:mr-3 group-hover:scale-125 transition-transform"></i> Share This Magic
                    </button>
                    <button id="playMusic" class="group px-6 py-4 md:px-8 md:py-5 bg-gradient-to-r from-emerald-600 to-green-700 text-white font-bold rounded-3xl hover:from-emerald-700 hover:to-green-800 transition-all duration-300 shadow-2xl hover:shadow-3xl transform hover:-translate-y-1 action-button slide-in" style="animation-delay: 0.2s;">
                        <i class="fas fa-music mr-2 md:mr-3 group-hover:animate-spin"></i> <span id="musicText">üéµ Play Music</span>
                    </button>
                </div>

                <!-- More Actions -->
                <div class="flex flex-wrap justify-center gap-2 md:gap-4">
                    <button id="moreConfetti" class="px-4 py-3 md:px-6 md:py-3 bg-gradient-to-r from-amber-500/20 to-orange-500/20 text-amber-300 font-semibold rounded-2xl hover:from-amber-500/30 hover:to-orange-500/30 transition-all duration-300 border border-amber-500/30 action-button slide-in" style="animation-delay: 0.3s;">
                        <i class="fas fa-burst mr-2"></i> üéä More Confetti
                    </button>
                    <button id="takeScreenshot" class="px-4 py-3 md:px-6 md:py-3 bg-gradient-to-r from-cyan-500/20 to-blue-500/20 text-cyan-300 font-semibold rounded-2xl hover:from-cyan-500/30 hover:to-blue-500/30 transition-all duration-300 border border-cyan-500/30 action-button slide-in" style="animation-delay: 0.4s;">
                        <i class="fas fa-camera mr-2"></i> üì∏ Capture Moment
                    </button>
                    <button id="sendThanks" class="px-4 py-3 md:px-6 md:py-3 bg-gradient-to-r from-pink-500/20 to-rose-500/20 text-pink-300 font-semibold rounded-2xl hover:from-pink-500/30 hover:to-rose-500/30 transition-all duration-300 border border-pink-500/30 action-button slide-in" style="animation-delay: 0.5s;">
                        <i class="fas fa-heart mr-2"></i> üíñ Send Thanks
                    </button>
                    <button id="moreBalloons" class="px-4 py-3 md:px-6 md:py-3 bg-gradient-to-r from-purple-500/20 to-indigo-500/20 text-purple-300 font-semibold rounded-2xl hover:from-purple-500/30 hover:to-indigo-500/30 transition-all duration-300 border border-purple-500/30 action-button slide-in" style="animation-delay: 0.6s;">
                        <i class="fas fa-cloud mr-2"></i> üéà More Balloons
                    </button>
                    <button id="fireworksBtn" class="px-4 py-3 md:px-6 md:py-3 bg-gradient-to-r from-red-500/20 to-orange-500/20 text-red-300 font-semibold rounded-2xl hover:from-red-500/30 hover:to-orange-500/30 transition-all duration-300 border border-red-500/30 action-button slide-in" style="animation-delay: 0.7s;">
                        <i class="fas fa-fire mr-2"></i> üéá Fireworks
                    </button>
                </div>
            </div>

            <!-- Celebration Message -->
            <div class="mt-8 md:mt-12 text-center text-gray-300 slide-in" style="animation-delay: 0.8s;">
                <p class="text-base md:text-lg mb-2">‚ú® This card was created with magic using Celebration Wishes ‚ú®</p>
                <p class="text-sm md:text-base text-gray-400 mb-4">Share the joy - create your own magical card for someone special!</p>
                <div class="flex justify-center space-x-3 md:space-x-4">
                    <i class="fas fa-sparkles text-yellow-400 text-xl md:text-2xl animate-pulse"></i>
                    <i class="fas fa-star text-cyan-400 text-xl md:text-2xl animate-pulse" style="animation-delay: 0.2s;"></i>
                    <i class="fas fa-heart text-pink-400 text-xl md:text-2xl animate-pulse" style="animation-delay: 0.4s;"></i>
                    <i class="fas fa-magic text-purple-400 text-xl md:text-2xl animate-pulse" style="animation-delay: 0.6s;"></i>
                    <i class="fas fa-sparkles text-green-400 text-xl md:text-2xl animate-pulse" style="animation-delay: 0.8s;"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Celebration Button -->
    <button id="mobileCelebrateBtn" class="md:hidden fixed bottom-6 right-6 z-40 w-14 h-14 bg-gradient-to-r from-cyan-500 via-purple-500 to-pink-500 rounded-full flex items-center justify-center shadow-2xl hover:shadow-3xl transition-all duration-300 hover:scale-110 animate-pulse-glow">
        <i class="fas fa-party-horn text-white text-xl"></i>
    </button>

    <!-- Audio Elements -->
    <audio id="celebrationMusic" loop>
        <source src="https://assets.mixkit.co/music/preview/mixkit-happy-birthday-to-you-443.mp3" type="audio/mpeg">
    </audio>
    <audio id="confettiSound">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-confetti-cannon-1001.mp3" type="audio/mpeg">
    </audio>
    <audio id="fireworkSound">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-firework-show-explosion-3104.mp3" type="audio/mpeg">
    </audio>

    <script>
        // Enhanced Card data
        let cardData = null;
        let musicPlaying = false;
        let viewCount = 0;
        let confettiCount = 0;
        let startTime = Date.now();
        let celebrationInterval;
        
        // DOM Elements
        const backgroundEffects = document.getElementById('backgroundEffects');
        const cardContainer = document.getElementById('cardContainer');
        const shareButton = document.getElementById('shareButton');
        const playMusicButton = document.getElementById('playMusic');
        const musicText = document.getElementById('musicText');
        const celebrationMusic = document.getElementById('celebrationMusic');
        const confettiSound = document.getElementById('confettiSound');
        const fireworkSound = document.getElementById('fireworkSound');
        const moreConfettiButton = document.getElementById('moreConfetti');
        const moreBalloonsButton = document.getElementById('moreBalloons');
        const fireworksBtn = document.getElementById('fireworksBtn');
        const takeScreenshotButton = document.getElementById('takeScreenshot');
        const sendThanksButton = document.getElementById('sendThanks');
        const celebrationStats = document.getElementById('celebrationStats');
        const mobileCelebrateBtn = document.getElementById('mobileCelebrateBtn');
        
        // Occasion data mapping
        const occasionData = {
            birthday: { title: "Happy Birthday", icon: "fa-birthday-cake" },
            achievement: { title: "Congratulations", icon: "fa-trophy" },
            special: { title: "Special Day", icon: "fa-star" },
            surprise: { title: "Surprise!", icon: "fa-sparkles" }
        };
        
        // Enhanced Color theme mapping
        const colorThemes = {
            ocean: { 
                bg: 'from-cyan-900/30 via-blue-900/30 to-purple-900/30', 
                text: 'from-cyan-400 via-blue-400 to-cyan-300',
                accent: 'cyan'
            },
            forest: { 
                bg: 'from-emerald-900/30 via-green-900/30 to-teal-900/30', 
                text: 'from-emerald-400 via-green-400 to-emerald-300',
                accent: 'emerald'
            },
            sunset: { 
                bg: 'from-amber-900/20 via-orange-900/20 to-yellow-900/20', 
                text: 'from-amber-300 via-yellow-300 to-orange-300',
                accent: 'amber'
            },
            berry: { 
                bg: 'from-purple-900/40 via-pink-900/30 to-rose-900/40', 
                text: 'from-purple-300 via-pink-300 to-purple-300',
                accent: 'purple'
            },
            coral: { 
                bg: 'from-rose-900/30 via-red-900/30 to-pink-900/30', 
                text: 'from-rose-400 via-red-400 to-pink-400',
                accent: 'rose'
            },
            royal: { 
                bg: 'from-violet-900/30 via-indigo-900/30 to-purple-900/30', 
                text: 'from-violet-400 via-indigo-400 to-purple-400',
                accent: 'violet'
            },
            mint: { 
                bg: 'from-teal-900/30 via-cyan-900/30 to-emerald-900/30', 
                text: 'from-teal-400 via-cyan-400 to-emerald-400',
                accent: 'teal'
            },
            magenta: { 
                bg: 'from-fuchsia-900/30 via-purple-900/30 to-pink-900/30', 
                text: 'from-fuchsia-400 via-purple-400 to-pink-400',
                accent: 'fuchsia'
            },
            lime: { 
                bg: 'from-lime-900/30 via-green-900/30 to-emerald-900/30', 
                text: 'from-lime-400 via-green-400 to-emerald-400',
                accent: 'lime'
            },
            sky: { 
                bg: 'from-sky-900/30 via-blue-900/30 to-cyan-900/30', 
                text: 'from-sky-400 via-blue-400 to-cyan-400',
                accent: 'sky'
            },
            blush: { 
                bg: 'from-pink-900/30 via-rose-900/30 to-red-900/30', 
                text: 'from-pink-400 via-rose-400 to-red-400',
                accent: 'pink'
            },
            gold: { 
                bg: 'from-amber-900/30 via-yellow-900/30 to-orange-900/30', 
                text: 'from-amber-400 via-yellow-400 to-orange-400',
                accent: 'amber'
            },
            aqua: { 
                bg: 'from-blue-900/30 via-cyan-900/30 to-teal-900/30', 
                text: 'from-blue-400 via-cyan-400 to-teal-400',
                accent: 'blue'
            },
            twilight: { 
                bg: 'from-purple-900/30 via-blue-900/30 to-indigo-900/30', 
                text: 'from-purple-400 via-blue-400 to-indigo-400',
                accent: 'purple'
            },
            fire: { 
                bg: 'from-orange-900/30 via-red-900/30 to-amber-900/30', 
                text: 'from-orange-400 via-red-400 to-amber-400',
                accent: 'orange'
            }
        };
        
        // Initialize the card with enhanced fallback system
        function initCard() {
            const urlParams = new URLSearchParams(window.location.search);
            const cardId = urlParams.get('id');
            const encodedData = urlParams.get('data');
            
            console.log('Loading card with params:', { cardId, encodedData: encodedData?.substring(0, 50) + '...' });
            
            // Priority 1: Try URL data parameter first (universal)
            if (encodedData) {
                try {
                    // Try LZString decompression first
                    const decompressed = LZString.decompressFromEncodedURIComponent(encodedData);
                    if (decompressed) {
                        cardData = JSON.parse(decompressed);
                        console.log('Successfully loaded from LZString compressed data');
                    } else {
                        // Fallback to base64 decode
                        try {
                            const decodedData = atob(encodedData);
                            cardData = JSON.parse(decodedData);
                            console.log('Successfully loaded from base64 data');
                        } catch (e) {
                            // Try URL decode then base64
                            const urlDecoded = decodeURIComponent(encodedData);
                            const decodedData = atob(urlDecoded);
                            cardData = JSON.parse(decodedData);
                            console.log('Successfully loaded from URL decoded + base64 data');
                        }
                    }
                    
                    // Add ID if not present
                    if (cardData && !cardData.id) {
                        cardData.id = 'card_' + Date.now() + '_' + Math.random().toString(36).substr(2, 12);
                    }
                    
                    // Save to localStorage for faster loading next time
                    if (cardData && cardData.id) {
                        localStorage.setItem(cardData.id, JSON.stringify(cardData));
                    }
                    
                    loadCard();
                    createWelcomeCelebration();
                    return;
                } catch (error) {
                    console.error("Error loading from URL data:", error);
                }
            }
            
            // Priority 2: Try localStorage with cardId
            if (cardId) {
                const storedData = localStorage.getItem(cardId);
                if (storedData) {
                    try {
                        cardData = JSON.parse(storedData);
                        console.log('Successfully loaded from localStorage');
                        loadCard();
                        createWelcomeCelebration();
                        return;
                    } catch (error) {
                        console.error("Error loading from localStorage:", error);
                    }
                }
            }
            
            // Priority 3: Try URL hash fragment as last resort
            const hash = window.location.hash.substring(1);
            if (hash) {
                try {
                    const decompressed = LZString.decompressFromEncodedURIComponent(hash);
                    if (decompressed) {
                        cardData = JSON.parse(decompressed);
                        console.log('Successfully loaded from hash fragment (LZString)');
                    } else {
                        const decoded = atob(hash);
                        cardData = JSON.parse(decoded);
                        console.log('Successfully loaded from hash fragment (base64)');
                    }
                    loadCard();
                    createWelcomeCelebration();
                    return;
                } catch (error) {
                    console.error("Error loading from hash:", error);
                }
            }
            
            // If nothing works, show error
            showError();
        }
        
        function loadCard() {
            showTemplate(cardData.template || '1');
            updateTemplateContent();
            startEnhancedCelebrations();
            startTimeTracker();
            celebrationStats.classList.remove('hidden');
            
            // Increment view count
            viewCount++;
            updateStats();
        }
        
        function showError() {
            cardContainer.innerHTML = `
                <div class="bg-gradient-to-br from-gray-800/80 to-gray-900/80 rounded-4xl p-8 md:p-16 text-center glass-effect">
                    <div class="w-24 h-24 md:w-32 md:h-32 rounded-full bg-gradient-to-r from-cyan-500 via-purple-500 to-pink-500 flex items-center justify-center mx-auto mb-8 animate-pulse heartbeat">
                        <i class="fas fa-exclamation-triangle text-white text-4xl md:text-6xl"></i>
                    </div>
                    <h2 class="text-2xl md:text-4xl font-bold text-white mb-6">üéà Card Not Found</h2>
                    <p class="text-gray-300 text-base md:text-xl mb-8">This magic link seems to have expired or the celebration has moved on.</p>
                    <div class="space-y-4 md:space-y-6">
                        <a href="index.html" class="inline-block px-8 py-4 md:px-12 md:py-5 bg-gradient-to-r from-cyan-600 to-blue-700 text-white font-bold rounded-3xl hover:from-cyan-700 hover:to-blue-800 transition-all duration-300 shadow-2xl hover:shadow-3xl text-sm md:text-base">
                            <i class="fas fa-home mr-3"></i> Back to Home
                        </a>
                        <a href="create.html" class="inline-block px-8 py-4 md:px-12 md:py-5 bg-gradient-to-r from-purple-600 to-pink-700 text-white font-bold rounded-3xl hover:from-purple-700 hover:to-pink-800 transition-all duration-300 shadow-2xl hover:shadow-3xl text-sm md:text-base">
                            <i class="fas fa-magic mr-3"></i> Create New Magic
                        </a>
                    </div>
                </div>
            `;
        }
        
        // Show the selected template
        function showTemplate(templateId) {
            ['template1', 'template2', 'template3'].forEach((id, index) => {
                const element = document.getElementById(id);
                element.classList.toggle('hidden', (index + 1) != templateId);
            });
        }
        
        // Update template content with enhanced effects
        function updateTemplateContent() {
            if (!cardData) return;
            
            const occasion = cardData.occasion || 'birthday';
            const occasionInfo = occasionData[occasion] || occasionData.birthday;
            const colorTheme = cardData.colorTheme || 'ocean';
            const theme = colorThemes[colorTheme] || colorThemes.ocean;
            
            // Update all templates
            for (let i = 1; i <= 3; i++) {
                // Update occasion
                const occasionElement = document.getElementById(`template${i}Occasion`);
                if (occasionElement) occasionElement.textContent = occasionInfo.title;
                
                // Update icon
                const iconElement = document.getElementById(`template${i}Icon`);
                if (iconElement) iconElement.className = `fas ${occasionInfo.icon} text-white text-${i === 3 ? '4xl md:text-6xl' : '3xl md:text-5xl'}`;
                
                // Update photo if exists
                const photoContainer = document.getElementById(`template${i}Photo`);
                if (photoContainer && cardData.photo) {
                    photoContainer.innerHTML = `<img src="${cardData.photo}" class="w-full h-full object-cover rounded-full" style="border: 8px solid rgba(255,255,255,0.8);">`;
                } else if (photoContainer && !photoContainer.querySelector('img')) {
                    photoContainer.innerHTML = `<i id="template${i}Icon" class="fas ${occasionInfo.icon} text-white text-${i === 3 ? '4xl md:text-6xl' : '3xl md:text-5xl'}"></i>`;
                }
                
                // Update name
                const nameElement = document.getElementById(`template${i}Name`);
                if (nameElement && cardData.recipientName) {
                    nameElement.textContent = cardData.recipientName + (i === 3 ? "" : "!");
                    if (i === 1) {
                        nameElement.className = `text-4xl md:text-5xl lg:text-6xl font-bold mb-6 bg-gradient-to-r ${theme.text} bg-clip-text text-transparent neon-text shine glow-text`;
                    }
                }
                
                // Update message
                const messageElement = document.getElementById(`template${i}Message`);
                if (messageElement && cardData.message) {
                    messageElement.textContent = `"${cardData.message}"`;
                }
                
                // Update sender
                const senderElement = document.getElementById(`template${i}Sender`);
                if (senderElement && cardData.senderName) {
                    const senderText = i === 1 ? 
                        `From your friend, <span class="font-bold text-cyan-300">${cardData.senderName}</span>` :
                        i === 2 ? 
                        `From your friend, <span class="font-bold text-white neon-text">${cardData.senderName}</span>` :
                        `From your friend, <span class="font-bold text-yellow-300">${cardData.senderName}</span>`;
                    senderElement.innerHTML = senderText;
                }
                
                // Update template background based on theme
                const templateDiv = document.getElementById(`template${i}`);
                if (templateDiv && i == cardData.template) {
                    const firstDiv = templateDiv.querySelector('div');
                    if (firstDiv && theme.bg) {
                        firstDiv.className = `min-h-[500px] md:min-h-[600px] bg-gradient-to-br ${theme.bg} p-6 md:p-12 relative overflow-hidden`;
                    }
                }
            }
            
            // Update page title
            document.title = `üéâ ${occasionInfo.title} ${cardData.recipientName} | Celebration Wishes ‚ú®`;
        }
        
        // Create welcome celebration with enhanced effects
        function createWelcomeCelebration() {
            createEmojiRain();
            createFireworkBurst(5);
            createBalloonBurst(15);
            createConfettiBurst(200);
            
            // Play welcome sound
            setTimeout(() => {
                playSound(confettiSound);
                playSound(fireworkSound);
            }, 500);
        }
        
        // Start enhanced celebrations
        function startEnhancedCelebrations() {
            createBackgroundParticles();
            createFloatingElements();
            startContinuousConfetti();
            
            // Start music if enabled
            if (cardData.effects && cardData.effects.includes('music')) {
                setTimeout(() => {
                    celebrationMusic.play().catch(() => {
                        console.log("Music autoplay blocked. Click play button to enable.");
                    });
                    musicPlaying = true;
                    musicText.innerHTML = '<i class="fas fa-volume-up mr-3"></i> ‚è∏Ô∏è Pause Music';
                }, 2000);
            }
        }
        
        // Create enhanced background particles
        function createBackgroundParticles() {
            const colors = [
                'rgba(6, 182, 212, 0.4)',  // cyan
                'rgba(16, 185, 129, 0.4)', // emerald
                'rgba(245, 158, 11, 0.4)', // amber
                'rgba(139, 92, 246, 0.4)', // purple
                'rgba(239, 68, 68, 0.4)',   // red
                'rgba(236, 72, 153, 0.4)',  // pink
                'rgba(34, 197, 94, 0.4)'    // green
            ];
            
            for (let i = 0; i < 80; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.width = Math.random() * 30 + 5 + 'px';
                particle.style.height = particle.style.width;
                particle.style.left = Math.random() * 100 + 'vw';
                particle.style.top = Math.random() * 100 + 'vh';
                particle.style.background = colors[Math.floor(Math.random() * colors.length)];
                particle.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                particle.style.opacity = Math.random() * 0.5 + 0.1;
                particle.style.animation = `float ${Math.random() * 15 + 10}s ease-in-out infinite`;
                particle.style.animationDelay = Math.random() * 5 + 's';
                particle.style.filter = 'blur(2px)';
                backgroundEffects.appendChild(particle);
            }
        }
        
        // Start continuous confetti
        function startContinuousConfetti() {
            setInterval(() => {
                if (Math.random() > 0.6) {
                    createConfettiBurst(40);
                    confettiCount += 40;
                    updateStats();
                }
                
                // Random balloon
                if (Math.random() > 0.8) {
                    createBalloon();
                }
                
                // Random emoji
                if (Math.random() > 0.9) {
                    createFallingEmoji();
                }
            }, 4000);
        }
        
        // Create confetti burst with enhanced effects
        function createConfettiBurst(count = 100) {
            const colors = ['#06b6d4', '#10b981', '#f59e0b', '#8b5cf6', '#ef4444', '#ec4899', '#8b5cf6', '#3b82f6', '#22c55e'];
            const shapes = ['circle', 'square', 'triangle'];
            
            for (let i = 0; i < count; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.width = Math.random() * 15 + 3 + 'px';
                confetti.style.height = Math.random() * 15 + 3 + 'px';
                
                // Random shapes
                const shape = shapes[Math.floor(Math.random() * shapes.length)];
                if (shape === 'triangle') {
                    confetti.style.clipPath = 'polygon(50% 0%, 0% 100%, 100% 100%)';
                    confetti.style.borderRadius = '0';
                } else if (shape === 'square') {
                    confetti.style.borderRadius = '0';
                } else {
                    confetti.style.borderRadius = '50%';
                }
                
                confetti.style.opacity = Math.random() * 0.9 + 0.1;
                confetti.style.animation = `confetti-fall ${Math.random() * 4 + 2}s ease-out forwards`;
                confetti.style.animationDelay = Math.random() * 1 + 's';
                backgroundEffects.appendChild(confetti);
                
                setTimeout(() => confetti.remove(), 6000);
            }
            
            playSound(confettiSound);
        }
        
        // Create balloon with enhanced effects
        function createBalloon() {
            const colors = ['#ff6b6b', '#4ecdc4', '#ffd166', '#06d6a0', '#118ab2', '#ef476f', '#ff9a76', '#7bc950'];
            const balloon = document.createElement('div');
            balloon.className = 'particle balloon';
            balloon.style.left = Math.random() * 100 + 'vw';
            balloon.style.bottom = '-100px';
            balloon.style.width = '40px';
            balloon.style.height = '50px';
            balloon.style.background = `radial-gradient(circle at 30% 30%, ${colors[Math.floor(Math.random() * colors.length)]} 0%, transparent 70%)`;
            balloon.style.borderRadius = '50%';
            balloon.style.opacity = '0.9';
            balloon.style.setProperty('--tx', (Math.random() * 100 - 50) + 'px');
            balloon.style.setProperty('--rot', (Math.random() * 30 - 15) + 'deg');
            balloon.style.animation = `balloonFloat ${Math.random() * 15 + 10}s ease-in-out forwards`;
            balloon.style.filter = 'drop-shadow(0 4px 8px rgba(0,0,0,0.3))';
            
            // Add string
            const string = document.createElement('div');
            string.style.position = 'absolute';
            string.style.bottom = '0';
            string.style.left = '50%';
            string.style.width = '2px';
            string.style.height = '40px';
            string.style.background = 'linear-gradient(to bottom, rgba(255,255,255,0.5), transparent)';
            string.style.transform = 'translateX(-50%)';
            balloon.appendChild(string);
            
            backgroundEffects.appendChild(balloon);
            
            setTimeout(() => balloon.remove(), 15000);
        }
        
        // Create balloon burst
        function createBalloonBurst(count = 10) {
            for (let i = 0; i < count; i++) {
                setTimeout(() => {
                    createBalloon();
                }, i * 200);
            }
        }
        
        // Create firework burst
        function createFireworkBurst(count = 3) {
            for (let i = 0; i < count; i++) {
                setTimeout(() => {
                    const x = 20 + Math.random() * 60;
                    const y = 30 + Math.random() * 40;
                    
                    for (let j = 0; j < 50; j++) {
                        const spark = document.createElement('div');
                        spark.className = 'particle firework';
                        spark.style.left = x + 'vw';
                        spark.style.top = y + 'vh';
                        spark.style.backgroundColor = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff'][Math.floor(Math.random() * 6)];
                        spark.style.width = '6px';
                        spark.style.height = '6px';
                        spark.style.borderRadius = '50%';
                        spark.style.setProperty('--ty', (Math.random() * 100 - 50) + 'px');
                        spark.style.animation = `fireworkBurst ${Math.random() * 0.5 + 1}s ease-out forwards`;
                        spark.style.animationDelay = Math.random() * 0.3 + 's';
                        spark.style.filter = 'blur(1px)';
                        backgroundEffects.appendChild(spark);
                        
                        setTimeout(() => spark.remove(), 1500);
                    }
                    
                    playSound(fireworkSound);
                }, i * 500);
            }
        }
        
        // Create emoji rain
        function createEmojiRain() {
            const emojis = ['üéâ', '‚ú®', 'ü•≥', 'üéä', 'üéà', 'üéÅ', 'üåü', 'üí´', '‚ù§Ô∏è', 'üòä', 'üéÇ', 'üç∞', 'ü•Ç', 'üéÜ', 'üéá', 'ü¶Ñ', 'üåà'];
            
            for (let i = 0; i < 25; i++) {
                setTimeout(() => {
                    const emoji = document.createElement('div');
                    emoji.className = 'particle emoji-rain';
                    emoji.style.fontSize = Math.random() * 24 + 16 + 'px';
                    emoji.style.left = Math.random() * 100 + 'vw';
                    emoji.style.top = '-50px';
                    emoji.style.opacity = '0.9';
                    emoji.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                    emoji.style.animation = `emojiFall ${Math.random() * 5 + 3}s linear forwards`;
                    backgroundEffects.appendChild(emoji);
                    
                    setTimeout(() => emoji.remove(), 8000);
                }, i * 200);
            }
        }
        
        // Create falling emoji
        function createFallingEmoji() {
            const emojis = ['üéâ', '‚ú®', 'ü•≥', 'üéä', 'üéà'];
            const emoji = document.createElement('div');
            emoji.className = 'particle';
            emoji.style.fontSize = '32px';
            emoji.style.left = Math.random() * 100 + 'vw';
            emoji.style.top = '-50px';
            emoji.style.opacity = '0.9';
            emoji.textContent = emojis[Math.floor(Math.random() * emojis.length)];
            emoji.style.animation = `confetti-fall ${Math.random() * 4 + 3}s ease-out forwards`;
            backgroundEffects.appendChild(emoji);
            
            setTimeout(() => emoji.remove(), 7000);
        }
        
        // Create floating elements
        function createFloatingElements() {
            const effects = (cardData.effects || '').split(',');
            
            if (effects.includes('balloons')) {
                createBalloonBurst(8);
            }
            if (effects.includes('sparkles')) {
                createSparkleField();
            }
        }
        
        function createSparkleField() {
            setInterval(() => {
                const sparkle = document.createElement('div');
                sparkle.className = 'particle sparkle-trail';
                sparkle.style.left = Math.random() * 100 + 'vw';
                sparkle.style.top = Math.random() * 100 + 'vh';
                sparkle.style.width = '8px';
                sparkle.style.height = '8px';
                sparkle.style.background = 'radial-gradient(circle, white 0%, transparent 70%)';
                sparkle.style.boxShadow = '0 0 20px 5px white';
                sparkle.style.animation = 'sparkleTrail 1s ease-out forwards';
                backgroundEffects.appendChild(sparkle);
                
                setTimeout(() => sparkle.remove(), 1000);
            }, 800);
        }
        
        // Start time tracker
        function startTimeTracker() {
            celebrationInterval = setInterval(() => {
                const timeElapsed = Math.floor((Date.now() - startTime) / 1000);
                document.getElementById('timeSpent').textContent = timeElapsed + 's';
            }, 1000);
        }
        
        // Update stats
        function updateStats() {
            document.getElementById('viewCount').textContent = viewCount;
            document.getElementById('confettiCount').textContent = confettiCount;
        }
        
        // Play sound
        function playSound(audioElement) {
            if (audioElement) {
                audioElement.currentTime = 0;
                audioElement.play().catch(() => {
                    // Audio play failed (user interaction required)
                });
            }
        }
        
        // Event Listeners with enhanced effects
        shareButton.addEventListener('click', () => {
            if (!cardData) return;
            
            const shareText = `üéâ Check out this amazing celebration card created for ${cardData.recipientName || 'me'}! ‚ú®`;
            
            // Generate shareable URL with compressed data
            const jsonData = JSON.stringify(cardData);
            const compressed = LZString.compressToEncodedURIComponent(jsonData);
            const shareUrl = `${window.location.origin}${window.location.pathname}?data=${compressed}`;
            
            if (navigator.share) {
                navigator.share({
                    title: `Celebration Card for ${cardData.recipientName}`,
                    text: shareText,
                    url: shareUrl,
                }).catch(err => {
                    console.log('Share API failed:', err);
                    copyToClipboardWithFeedback(shareUrl);
                });
            } else {
                copyToClipboardWithFeedback(shareUrl);
            }
        });
        
        function copyToClipboardWithFeedback(text) {
            navigator.clipboard.writeText(text).then(() => {
                // Create celebration effect
                createConfettiBurst(80);
                createEmojiRain();
                
                // Show notification
                const notification = document.createElement('div');
                notification.className = 'fixed top-6 left-1/2 transform -translate-x-1/2 bg-gradient-to-r from-green-600 to-emerald-700 text-white px-6 py-3 rounded-full shadow-2xl z-50 animate-pop-in flex items-center';
                notification.innerHTML = '<i class="fas fa-check mr-2"></i> Link copied to clipboard! Share the magic! ‚ú®';
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.classList.add('opacity-0', 'transform', '-translate-y-4');
                    setTimeout(() => notification.remove(), 300);
                }, 3000);
            }).catch(err => {
                console.error('Failed to copy:', err);
                // Fallback for browsers that don't support clipboard API
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                
                // Still show feedback
                createConfettiBurst(80);
            });
        }
        
        playMusicButton.addEventListener('click', () => {
            if (musicPlaying) {
                celebrationMusic.pause();
                musicText.innerHTML = '<i class="fas fa-music mr-3"></i> üéµ Play Music';
                musicPlaying = false;
            } else {
                celebrationMusic.play().catch(() => {
                    musicText.innerHTML = '<i class="fas fa-volume-mute mr-3"></i> üîä Click to Unmute';
                });
                musicText.innerHTML = '<i class="fas fa-volume-up mr-3"></i> ‚è∏Ô∏è Pause Music';
                musicPlaying = true;
                
                // Create music visualization effect
                createConfettiBurst(50);
            }
        });
        
        moreConfettiButton.addEventListener('click', () => {
            createConfettiBurst(200);
            createEmojiRain();
            confettiCount += 200;
            updateStats();
            
            // Button feedback
            moreConfettiButton.classList.add('animate-pulse');
            setTimeout(() => moreConfettiButton.classList.remove('animate-pulse'), 1000);
        });
        
        moreBalloonsButton.addEventListener('click', () => {
            createBalloonBurst(15);
            
            // Button feedback
            moreBalloonsButton.classList.add('animate-bounce');
            setTimeout(() => moreBalloonsButton.classList.remove('animate-bounce'), 1000);
        });
        
        fireworksBtn.addEventListener('click', () => {
            createFireworkBurst(5);
            
            // Button feedback
            fireworksBtn.classList.add('animate-pulse-glow');
            setTimeout(() => fireworksBtn.classList.remove('animate-pulse-glow'), 1000);
        });
        
        takeScreenshotButton.addEventListener('click', () => {
            // Show loading state
            takeScreenshotButton.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Capturing...';
            takeScreenshotButton.disabled = true;
            
            // Check if html2canvas is loaded
            if (typeof html2canvas === 'undefined') {
                // Load html2canvas if not loaded
                const script = document.createElement('script');
                script.src = 'https://html2canvas.hertzen.com/dist/html2canvas.min.js';
                script.onload = () => {
                    captureScreenshot();
                };
                document.head.appendChild(script);
            } else {
                captureScreenshot();
            }
        });
        
        function captureScreenshot() {
            // Add screenshot effect
            cardContainer.style.filter = 'brightness(1.2)';
            setTimeout(() => cardContainer.style.filter = '', 300);
            
            html2canvas(cardContainer, {
                backgroundColor: null,
                scale: 2,
                useCORS: true,
                allowTaint: true
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = `celebration-card-${Date.now()}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
                
                // Create camera emoji effect
                const cameraEmoji = document.createElement('div');
                cameraEmoji.className = 'particle celebration-emoji';
                cameraEmoji.style.fontSize = '48px';
                cameraEmoji.style.left = '50%';
                cameraEmoji.style.top = '50%';
                cameraEmoji.style.transform = 'translate(-50%, -50%)';
                cameraEmoji.textContent = 'üì∏';
                cameraEmoji.style.zIndex = '1000';
                document.body.appendChild(cameraEmoji);
                
                setTimeout(() => cameraEmoji.remove(), 2000);
                
                // Show notification
                const notification = document.createElement('div');
                notification.className = 'fixed top-6 left-1/2 transform -translate-x-1/2 bg-gradient-to-r from-blue-600 to-cyan-700 text-white px-6 py-3 rounded-full shadow-2xl z-50 animate-pop-in';
                notification.innerHTML = '<i class="fas fa-check mr-2"></i> Screenshot saved! üì∏';
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.classList.add('opacity-0', 'transform', '-translate-y-4');
                    setTimeout(() => notification.remove(), 300);
                }, 3000);
                
                // Reset button
                takeScreenshotButton.innerHTML = '<i class="fas fa-camera mr-2"></i> üì∏ Capture Moment';
                takeScreenshotButton.disabled = false;
            }).catch(err => {
                console.error('Screenshot failed:', err);
                alert('üì∏ Screenshot feature failed. Please try again!');
                takeScreenshotButton.innerHTML = '<i class="fas fa-camera mr-2"></i> üì∏ Capture Moment';
                takeScreenshotButton.disabled = false;
            });
        }
        
        sendThanksButton.addEventListener('click', () => {
            const thanksModal = document.createElement('div');
            thanksModal.className = 'fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 animate-pop-in';
            thanksModal.innerHTML = `
                <div class="glass-effect rounded-3xl p-6 md:p-10 max-w-md mx-4 text-center border-2 border-purple-500/30">
                    <div class="w-20 h-20 md:w-24 md:h-24 rounded-full bg-gradient-to-r from-purple-500 to-pink-500 flex items-center justify-center mx-auto mb-4 md:mb-6 animate-heartbeat">
                        <i class="fas fa-heart text-white text-3xl md:text-4xl"></i>
                    </div>
                    <h3 class="text-xl md:text-2xl font-bold text-white mb-3 md:mb-4">üíñ Thank You Sent!</h3>
                    <p class="text-gray-300 mb-4 md:mb-6">Your appreciation has been sent to ${cardData?.senderName || 'the sender'}! ‚ú®</p>
                    <div class="flex justify-center space-x-2 mb-4">
                        <i class="fas fa-heart text-pink-500 animate-pulse"></i>
                        <i class="fas fa-star text-yellow-500 animate-pulse" style="animation-delay: 0.2s;"></i>
                        <i class="fas fa-heart text-purple-500 animate-pulse" style="animation-delay: 0.4s;"></i>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" class="px-6 py-3 md:px-8 md:py-4 bg-gradient-to-r from-purple-600 to-pink-700 text-white font-bold rounded-2xl hover:from-purple-700 hover:to-pink-800 transition-all duration-300">
                        Continue Celebrating
                    </button>
                </div>
            `;
            document.body.appendChild(thanksModal);
            
            // Create heart animation
            for (let i = 0; i < 15; i++) {
                setTimeout(() => {
                    const heart = document.createElement('div');
                    heart.className = 'particle';
                    heart.innerHTML = '‚ù§Ô∏è';
                    heart.style.fontSize = '24px';
                    heart.style.left = Math.random() * 100 + 'vw';
                    heart.style.top = '100vh';
                    heart.style.animation = `confetti-fall ${Math.random() * 2 + 1}s linear forwards`;
                    backgroundEffects.appendChild(heart);
                    
                    setTimeout(() => heart.remove(), 3000);
                }, i * 200);
            }
        });
        
        // Mobile celebrate button
        mobileCelebrateBtn.addEventListener('click', function() {
            createConfettiBurst(150);
            createFireworkBurst(3);
            createBalloonBurst(10);
            confettiCount += 150;
            updateStats();
            
            this.classList.add('animate-spin');
            setTimeout(() => this.classList.remove('animate-spin'), 1000);
        });
        
        // Initialize with enhanced welcome
        document.addEventListener('DOMContentLoaded', () => {
            initCard();
            
            // Auto-play music on first interaction
            const enableMusic = () => {
                if (!musicPlaying && cardData?.effects && cardData.effects.includes && cardData.effects.includes('music')) {
                    celebrationMusic.play().catch(() => {
                        console.log("Music autoplay blocked");
                    });
                    musicPlaying = true;
                    musicText.innerHTML = '<i class="fas fa-volume-up mr-3"></i> ‚è∏Ô∏è Pause Music';
                }
            };
            
            // Enable music on first click/touch
            document.addEventListener('click', enableMusic, { once: true });
            document.addEventListener('touchstart', enableMusic, { once: true });
        });
        
        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            clearInterval(celebrationInterval);
            if (musicPlaying) {
                celebrationMusic.pause();
            }
        });
        
        // Add mouse interaction effects
        document.addEventListener('mousemove', (e) => {
            if (Math.random() > 0.8) {
                const sparkle = document.createElement('div');
                sparkle.className = 'particle sparkle-trail';
                sparkle.style.left = e.clientX + 'px';
                sparkle.style.top = e.clientY + 'px';
                sparkle.style.width = '6px';
                sparkle.style.height = '6px';
                sparkle.style.background = 'radial-gradient(circle, white 0%, transparent 70%)';
                sparkle.style.boxShadow = '0 0 15px 5px gold';
                document.body.appendChild(sparkle);
                
                setTimeout(() => sparkle.remove(), 500);
            }
        });
    </script>
    
    <!-- HTML2Canvas for screenshot - Load only when needed -->
    <script>
        // Dynamically load html2canvas when needed
        function loadHtml2Canvas() {
            if (typeof html2canvas === 'undefined') {
                const script = document.createElement('script');
                script.src = 'https://html2canvas.hertzen.com/dist/html2canvas.min.js';
                document.head.appendChild(script);
                return script;
            }
            return Promise.resolve();
        }
    </script>
</body>
</html>